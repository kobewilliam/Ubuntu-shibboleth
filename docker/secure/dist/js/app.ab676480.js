(function(e){function t(t){for(var i,o,l=t[0],r=t[1],c=t[2],u=0,h=[];u<l.length;u++)o=l[u],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&h.push(a[o][0]),a[o]=0;for(i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i]);d&&d(t);while(h.length)h.shift()();return s.push.apply(s,c||[]),n()}function n(){for(var e,t=0;t<s.length;t++){for(var n=s[t],i=!0,l=1;l<n.length;l++){var r=n[l];0!==a[r]&&(i=!1)}i&&(s.splice(t--,1),e=o(o.s=n[0]))}return e}var i={},a={app:0},s=[];function o(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=i,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(n,i,function(t){return e[t]}.bind(null,i));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var l=window["webpackJsonp"]=window["webpackJsonp"]||[],r=l.push.bind(l);l.push=t,l=l.slice();for(var c=0;c<l.length;c++)t(l[c]);var d=r;s.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"02ce":function(e,t,n){},1:function(e,t){},2:function(e,t){},"2fe3":function(e,t,n){"use strict";var i=n("02ce"),a=n.n(i);a.a},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var i=n("a026"),a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("router-view")],1)},s=[],o={name:"App",data:function(){return{}},mounted:function(){},methods:{jump:function(){this.$router.push({name:"login"})}}},l=o,r=n("2877"),c=Object(r["a"])(l,a,s,!1,null,null,null),d=c.exports,u=n("8c4f"),h=n("bc3a"),p=n.n(h),g=n("5c96"),m=n.n(g),f=(n("0fae"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"title",rawName:"v-title"}],attrs:{id:"app","data-title":"SustainKG"}},[n("el-header",{staticStyle:{"text-align":"right",height:"40px"}},[n("div",{staticClass:"grid-content "},[[n("el-button",{directives:[{name:"show",rawName:"v-show",value:e.showLogin,expression:"showLogin"}],staticStyle:{"margin-right":"10px"},attrs:{size:"small",round:"",type:"primary"},on:{click:e.onTapLogin}},[e._v("Login")]),n("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.showLogin,expression:"!showLogin"}],staticStyle:{"margin-right":"5px"},attrs:{size:"small",type:"success",round:""}},[e._v(e._s(e.username))]),n("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.showLogin,expression:"!showLogin"}],attrs:{size:"small",round:""},on:{click:e.logout}},[e._v("Logout")])]],2)]),n("el-container",[n("el-aside",{attrs:{width:"200px"}},[n("h1",{staticStyle:{"margin-left":"25px"}},[e._v("Sustainability")]),n("h1",{staticStyle:{"margin-left":"25px"}},[e._v("Knowledge")]),n("h1",{staticStyle:{"margin-left":"25px"}},[e._v("Mapper")]),n("el-menu",{staticClass:"el-menu-vertical-demo",attrs:{"default-active":"2"}},[n("el-menu-item",{attrs:{index:"1",disabled:e.disable_submit},on:{click:function(t){return e.submitData()}}},[n("i",{staticClass:"el-icon-upload2"}),n("span",{attrs:{slot:"title"},slot:"title"},[e._v("Save")])]),n("el-menu-item",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{index:"2",disabled:e.disable_searchConcept},on:{click:e.searchConcept_dialog}},[n("i",{staticClass:"el-icon-search"}),n("span",{attrs:{slot:"title"},slot:"title"},[e._v(" Search Another Concept")])]),n("el-menu-item",[n("i",{staticClass:"el-icon-star-off"}),n("span",{attrs:{slot:"title"},slot:"title"},[e._v("Concepts："+e._s(e.info.nodes.length))])]),n("el-menu-item",[n("i",{staticClass:"el-icon-star-off"}),n("span",{attrs:{slot:"title"},slot:"title"},[e._v("Relationships："+e._s(e.info.links.length))])])],1),n("el-button",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticStyle:{"margin-top":"80px","margin-left":"15px"},attrs:{disabled:e.disable_viewGraph,size:"small",round:"",type:"primary"},on:{click:e.getAllConcepts}},[e._v(e._s(e.viewGraph_btn_status?"View Collective Graph":"View Personal Graph")+" ")]),n("el-button",{staticStyle:{"margin-top":"80px","margin-left":"15px"},attrs:{size:"small",round:"",type:"primary"},on:{click:e.instruction}},[n("i",{staticClass:"el-icon-info"}),e._v(" Instructions")]),n("el-button",{staticStyle:{"margin-top":"80px","margin-left":"15px"},attrs:{size:"small",round:"",type:"primary"},on:{click:e.TeamLogin}},[n("i",{staticClass:"el-icon-info"}),e._v(" Team Work")]),n("el-button",{directives:[{name:"show",rawName:"v-show",value:e.dashboard_show,expression:"dashboard_show"}],staticStyle:{"margin-top":"80px","margin-left":"15px"},attrs:{size:"small",round:"",type:"primary"},on:{click:e.getGraphStatistics}},[e._v("Dashboard")])],1),n("el-main",[n("el-row",{attrs:{id:"graph"}})],1)],1),n("el-dialog",{attrs:{"close-on-click-modal":!1,title:"Login",visible:e.centerDialogVisible,width:"30%",center:""},on:{"update:visible":function(t){e.centerDialogVisible=t}}},[n("span",[e._v("Username"),n("el-input",{attrs:{placeholder:"Please Input Username"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleShow(t)}},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}})],1),n("br"),n("br"),n("el-button",{staticStyle:{"margin-top":"15px"},attrs:{type:"text"},nativeOn:{click:function(t){e.dialog_createUser=!0,e.centerDialogVisible=!1}}},[e._v("No account?")]),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{nativeOn:{click:function(t){e.centerDialogVisible=!1}}},[e._v("No")]),n("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.handleShow(t)}}},[e._v("Yes")])],1)],1),n("el-dialog",{attrs:{"close-on-click-modal":!1,title:"Create New Account",visible:e.dialog_createUser,width:"30%",center:""},on:{"update:visible":function(t){e.dialog_createUser=t}}},[n("span",[e._v("Username"),n("el-input",{attrs:{placeholder:"Please Input Username"},model:{value:e.newUsername,callback:function(t){e.newUsername=t},expression:"newUsername"}})],1),n("br"),n("br"),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{nativeOn:{click:function(t){e.dialog_createUser=!1}}},[e._v("Cancel")]),n("el-button",{attrs:{type:"primary"},on:{click:e.createUser}},[e._v("Submit")])],1)]),n("el-dialog",{attrs:{"close-on-click-modal":!1,visible:e.dialogFormVisible,title:"Create Concept",center:""},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[n("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0}},[n("el-form-item",{attrs:{label:"Concept Name"}},[n("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"Concept Name"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search("select")}},model:{value:e.input,callback:function(t){e.input=t},expression:"input"}})],1),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.search("select")}}},[e._v("Search")])],1),n("el-form-item",{attrs:{label:"Result"}},[n("el-select",{ref:"select",staticStyle:{width:"200px","margin-left":"30px"},attrs:{placeholder:"Result",clearable:"","no-data-text":"No Concept Name found"},on:{change:e.selectChange,blur:e.blur,focus:e.focus},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.addNodes(t)}},model:{value:e.node_value,callback:function(t){e.node_value=t},expression:"node_value"}},e._l(e.node_list,(function(e,t){return n("el-option",{key:t,ref:"option",refInFor:!0,staticClass:"bar",attrs:{label:e.label,value:e.value}})})),1)],1)],1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:e.cancel}},[e._v(" Cancel ")]),n("el-button",{attrs:{type:"primary",disabled:e.btnChangeEnable},on:{click:e.addNodes}},[e._v(" Submit ")])],1)],1),n("el-dialog",{attrs:{"close-on-click-modal":!1,visible:e.dialogFormVisible_change_node_name,title:"Change Concept Name",center:""},on:{"update:visible":function(t){e.dialogFormVisible_change_node_name=t}}},[n("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,center:""}},[n("el-form-item",{attrs:{label:"Node Name"}},[n("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"Concept Name"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search("select_changeNode")}},model:{value:e.input,callback:function(t){e.input=t},expression:"input"}})],1),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.search("select_changeNode")}}},[e._v("Search")])],1),n("el-form-item",{attrs:{label:"Result"}},[n("el-select",{ref:"select_changeNode",staticStyle:{width:"200px","margin-left":"30px"},attrs:{placeholder:"Result",clearable:"","no-data-text":"No Concept Name found"},on:{change:e.selectChange,blur:e.blur},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.change_node_name(t)}},model:{value:e.new_node_name,callback:function(t){e.new_node_name=t},expression:"new_node_name"}},e._l(e.node_list,(function(e,t){return n("el-option",{key:t,staticClass:"bar",attrs:{label:e.label,value:e.value}})})),1)],1)],1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:e.cancel}},[e._v(" No ")]),n("el-button",{attrs:{type:"primary",disabled:e.btnChangeEnable},on:{click:e.change_node_name}},[e._v(" Yes ")])],1)],1),n("el-dialog",{attrs:{"close-on-click-modal":!1,visible:e.dialogFormVisible_link,"show-close":!1,title:"Create Link",center:""},on:{"update:visible":function(t){e.dialogFormVisible_link=t}}},[e._v(" Relationships Name "),n("el-select",{ref:"addLink",staticStyle:{width:"300px","margin-left":"50px"},attrs:{"label-position":"right","label-width":"86px",placeholder:"Please select",clearable:"","no-match-text":"No Relationships Name found"},on:{blur:e.showOption_add_link,clear:e.selectClear,change:e.selectChange},nativeOn:{keyup:[function(t){return e.showOption_add_link(t)},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.drag_addLinks(t)}]},model:{value:e.link_value,callback:function(t){e.link_value=t},expression:"link_value"}},e._l(e.link_list,(function(e,t){return n("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:e.cancel}},[e._v(" Cancel ")]),n("el-button",{attrs:{type:"primary",disabled:e.btnChangeEnable},on:{click:e.drag_addLinks}},[e._v(" Submit ")])],1)],1),n("el-dialog",{attrs:{"close-on-click-modal":!1,visible:e.dialogFormVisible_change_link_name,title:"Change Relationships Name",center:""},on:{"update:visible":function(t){e.dialogFormVisible_change_link_name=t}}},[e._v(" Relationships Name "),n("el-select",{ref:"changeLinkName",staticStyle:{width:"300px","margin-left":"30px"},attrs:{"label-position":"right","label-width":"86px",placeholder:"Please select",clearable:"","no-match-text":"No Relationships Name found"},on:{blur:e.showOption_change_link,clear:e.selectClear,change:e.selectChange},nativeOn:{keyup:[function(t){return e.showOption_change_link(t)},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.change_link_name(t)}]},model:{value:e.new_link_name,callback:function(t){e.new_link_name=t},expression:"new_link_name"}},e._l(e.link_list,(function(e,t){return n("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:e.cancel}},[e._v(" No ")]),n("el-button",{attrs:{type:"primary",disabled:e.btnChangeEnable},on:{click:e.change_link_name}},[e._v(" Yes ")])],1)],1),n("el-dialog",{attrs:{visible:e.dialogFormVisible_viewCollective,"show-close":!1,title:"View Collective Graph",center:"","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogFormVisible_viewCollective=t}}},[e._v(" Concept Name "),n("el-select",{ref:"viewCollective",staticStyle:{width:"300px","margin-left":"50px"},attrs:{"label-position":"right","label-width":"86px",placeholder:"Please select",clearable:"",filterable:"","no-match-text":"No Concept Name found"},on:{blur:e.showOption_view_graph,clear:e.selectClear,change:e.selectChange},nativeOn:{keyup:[function(t){return e.showOption_view_graph(t)},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchConcept(t)}]},model:{value:e.collective_node_value,callback:function(t){e.collective_node_value=t},expression:"collective_node_value"}},e._l(e.collective_node_list,(function(e,t){return n("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:e.collectiveGraph_cancel}},[e._v(" No ")]),n("el-button",{attrs:{type:"primary",disabled:e.btnChangeEnable},on:{click:e.searchConcept}},[e._v(" Yes ")])],1)],1),n("div",{directives:[{name:"show",rawName:"v-show",value:e.showdetail_node,expression:"showdetail_node"}],staticStyle:{"z-index":"-1"},attrs:{id:"node_info"}},[n("el-card",{staticClass:"node-card",staticStyle:{height:"250px"},style:{backgroundColor:"rgb(253, 216, 186)"}},[n("h2",{style:{color:"#ca635f"}},[e._v(e._s(e.detailname))]),n("div",[n("h5",{style:{color:"#aaaaff"}},[e._v(e._s(e.detailValue.snippet))])])])],1),n("div",{directives:[{name:"show",rawName:"v-show",value:e.showdetail_link,expression:"showdetail_link"}],attrs:{id:"link_info"}},[n("el-card",{staticClass:"link-card",style:{backgroundColor:"rgb(253, 216, 186)"}},[n("h2",{style:{color:"#ca635f"}},[e._v("Relationships Detail")]),n("div",[n("h4",{style:{color:"#aaaaff"}},[e._v("ID: "+e._s(e.detailValue.id))]),n("h4",{style:{color:"#aaaaff"}},[e._v("Name: "+e._s(e.detailname))]),n("h4",{style:{color:"#aaaaff"}},[e._v("Type: "+e._s(e.detailValue.type))]),n("h4",{style:{color:"#aaaaff"}},[e._v("Label: "+e._s(e.detailValue.label))])])])],1),n("el-dialog",{attrs:{visible:e.dialogFormVisible_instruction,title:"Instruction",center:""},on:{"update:visible":function(t){e.dialogFormVisible_instruction=t}}},[n("div",[n("h2",[e._v("Sustainability Knowledge Mapper")]),n("h1"),n("h4",[e._v("Welcome to Sustainability Knowledge Mapper. On this site you can build your own knowledge graph.")]),n("h4",[e._v("1. To add a concept, double-click the screen.")]),n("h4",[e._v("2. To add a relationship, click a concept so it turns red, then drag from that concept to a different concept.")]),n("h4",[e._v("3. To edit a concept or relationship, right-click (Windows) or control-click (Mac) on it.")]),n("h4",[e._v("4. Your work will be automatically saved whenever you close the browser window. You may save it manually by clicking the “Save” link. You do not need to do anything special to submit each assignment; the teaching staff will grade whatever content is visible here by each grading deadline")]),n("h4",[e._v("If you have any question, please email the teaching staff. We welcome any comments to help us improve this site. :)")])])])],1)}),_=[],v=(n("99af"),n("c975"),n("d81d"),n("fb6a"),n("a434"),n("0d03"),n("b0c0"),n("a9e3"),n("b64b"),n("d3b7"),n("ac1f"),n("25f0"),n("5319"),n("841c"),n("1276"),n("c7cd"),n("ddb0"),n("53ca")),b=n("6e58"),k=(n("639f"),"has effect"),y=(n("1157"),function(e){e.sourceRadius=40,e.targetRadius=42;var t=Math.abs((e.target.y-e.source.y)/(e.target.x-e.source.x)),n=e.target.x-e.source.x>0?Math.sqrt(e.sourceRadius*e.sourceRadius/(t*t+1))+e.source.x:e.source.x-Math.sqrt(e.sourceRadius*e.sourceRadius/(t*t+1)),i=e.target.y-e.source.y>0?Math.sqrt(e.sourceRadius*e.sourceRadius*t*t/(t*t+1))+e.source.y:e.source.y-Math.sqrt(e.sourceRadius*e.sourceRadius*t*t/(t*t+1)),a=e.target.x-e.source.x>0?e.target.x-Math.sqrt(e.targetRadius*e.targetRadius/(1+t*t)):e.target.x+Math.sqrt(e.targetRadius*e.targetRadius/(1+t*t)),s=e.target.y-e.source.y>0?e.target.y-Math.sqrt(e.targetRadius*e.targetRadius*t*t/(1+t*t)):e.target.y+Math.sqrt(e.targetRadius*e.targetRadius*t*t/(1+t*t));e.target.x-e.source.x!==0&&0!==t||(i=e.target.y-e.source.y>0?e.source.y+e.sourceRadius:e.source.y-e.sourceRadius,s=e.target.y-e.source.y>0?e.target.y-e.targetRadius:e.target.y+e.targetRadius);var o=e.sourceRadius>e.targetRadius?e.targetRadius*e.linknum/3:e.sourceRadius*e.linknum/3,l=e.target.x-e.source.x>0?e.source.x+Math.sqrt((e.sourceRadius*e.sourceRadius-o*o)/(1+t*t)):e.source.x-Math.sqrt((e.sourceRadius*e.sourceRadius-o*o)/(1+t*t)),r=e.target.y-e.source.y>0?e.source.y+Math.sqrt((e.sourceRadius*e.sourceRadius-o*o)*t*t/(1+t*t)):e.source.y-Math.sqrt((e.sourceRadius*e.sourceRadius-o*o)*t*t/(1+t*t)),c=e.target.x-e.source.x>0?e.target.x-Math.sqrt((e.targetRadius*e.targetRadius-o*o)/(1+t*t)):e.target.x+Math.sqrt((e.targetRadius*e.targetRadius-o*o)/(1+t*t)),d=e.target.y-e.source.y>0?e.target.y-Math.sqrt((e.targetRadius*e.targetRadius-o*o)*t*t/(1+t*t)):e.target.y+Math.sqrt((e.targetRadius*e.targetRadius-o*o)*t*t/(1+t*t));e.target.x-e.source.x!==0&&0!==t||(r=e.target.y-e.source.y>0?e.source.y+Math.sqrt(e.sourceRadius*e.sourceRadius-o*o):e.source.y-Math.sqrt(e.sourceRadius*e.sourceRadius-o*o),d=e.target.y-e.source.y>0?e.target.y-Math.sqrt(e.targetRadius*e.targetRadius-o*o):e.target.y+Math.sqrt(e.targetRadius*e.targetRadius-o*o));var u,h,p,g,m=(n-a)/(s-i),f=Math.sqrt(o*o/(1+m*m)),_=Math.sqrt(o*o*m*m/(1+m*m));return s-i===0&&(f=0,_=Math.sqrt(o*o)),o>0?(u=m>0?l-f:l+f,h=r-_,p=m>0?c-f:c+f,g=d-_):(u=m>0?l+f:l-f,h=r+_,p=m>0?c+f:c-f,g=d+_),e.x_start=u,e.y_start=h,e.x_end=p,e.y_end=g,u<p?"M"+u+" "+h+"L"+ +p+" "+g:u>=p?"M"+p+" "+g+"L"+ +u+" "+h:void 0}),x=function(e){if(0!==e.length)if(1!==e.length){var t=e.length%2===0?e.length/2:(e.length-1)/2;if(e.length%2===0)for(var n=.5-t,i=0;i<e.length;i++)e[i].linknum=n++;else for(var a=-t,s=0;s<e.length;s++)e[s].linknum=a++}else e[0].linknum=0},w=function(e){for(var t={},n={},i=0;i<e.length;i++){var a=e[i].source<e[i].target?e[i].source+":"+e[i].target:e[i].target+":"+e[i].source;n.hasOwnProperty(a)||(n[a]=0),n[a]+=1,t.hasOwnProperty(a)||(t[a]=[]),t[a].push(e[i])}for(var s=0;s<e.length;s++){var o=e[s].source<e[s].target?e[s].source+":"+e[s].target:e[s].target+":"+e[s].source;e[s].size=n[o];var l=t[o];x(l)}},C={name:"App",data:function(){var e=this;return{has_weight:!0,input:"",searchDialog:!1,disableSelect:!0,dashboard_show:!1,readOnly:!1,current_user:"",username:this.$route.params.username,newUsername:"",showLogin:!0,centerDialogVisible:!1,dialog_createUser:!1,optionVisible_viewGraph:!1,optionVisible_add_link:!1,optionVisible_change_link:!1,inputNodeContent:"",upload_nodes:"",upload_links:"",disable_submit:!0,disable_viewGraph:!0,disable_searchConcept:!0,disable_dbclick:!0,viewGraph_btn_status:!0,showdetail_node:!1,showdetail_link:!1,detailValue:"",detailname:"",node_value:"",link_value:"",init_node_value:"",btnChangeEnable:!0,node_list:[],collective_node_value:"",collective_node_list:[],entire_collective_data:[],link_list:[{value:"link1",label:"link1"},{value:"link2",label:"link2"},{value:"test_3",label:"test_3"}],info:{nodes:[],links:[]},ifClicked:!1,searchNode:!1,selected_Node:"",dialogFormVisible:!1,dialogFormVisible_link:!1,dialogFormVisible_viewCollective:!1,dialogFormVisible_change_node_name:!1,dialogFormVisible_change_link_name:!1,dialogFormVisible_instruction:!1,temp:[],clickTimeId:0,node_id:"",link_id:"",new_link_name:"",new_node_name:"",menu:[{title:"Delete Concept",action:function(t,n){e.$confirm("Delete this concept?","Tips",{confirmButtonText:"Yes",cancelButtonText:"No",type:"warning"}).then((function(){e.$message({type:"success",message:"The concept is deleted!"}),console.log("test !!!",n,t),e.info.nodes.splice(t,1);for(var i=e.info.links.length-1;i>=0;i--)console.log("link index",i,t),e.info.links[i].source!==n&&e.info.links[i].target!==n||e.info.links.splice(i,1);console.log("after delete",e.info);for(var a=0;a<e.info.nodes.length;a++)console.log(a),console.log(e.info.nodes[a].id,e.info.nodes[a].index),e.info.nodes[a].id=a;e.renderGraph(e.info)})).catch((function(){e.$message({type:"info",message:"Cancel Delete!"})}))}},{title:"Change Concept Name",action:function(t){e.dialogFormVisible_change_node_name=!0,e.node_id=t}}],menu_edge:[{title:"Delete Relationship",action:function(t,n){console.log("ll",t,n),e.$confirm("Delete this Relationship?","Tips",{confirmButtonText:"Yes",cancelButtonText:"No",type:"warning"}).then((function(){e.$message({type:"success",message:"The Relationship is deleted!"}),e.info.links.splice(t,1),e.renderGraph(e.info)})).catch((function(){e.$message({type:"info",message:"Cancel Delete!"})}))}},{title:"Change Relationship Name",action:function(t){e.dialogFormVisible_change_link_name=!0,e.link_id=t}}],dragStartIndex:"",dragEndIndex:"",mouseLinkLineStartLoc:[],original_dx:0,original_dy:0,dragNode:null,start:null,end:null,target_node_index:"",initial_links_count:0,temp_linklist:[],temp_nodelist:[],snippet:[],select_snippet:"",uci_id:""}},mounted:function(){var e=this;this.$axios({url:"https://graphdb.ics.uci.edu/Shibboleth.sso/Session",method:"get"}).then((function(t){console.log(t),e.username=t.data.attributes[0].values[0],console.log(e.username),e.handleShow()})),console.log("route name",this.$route.name),this.renderGraph(this.info),this.readTxt(),this.centerDialogVisible=!1,this.initial_links_count=this.info.links.length},methods:{submit2:function(){this.upload_nodes=this.info.nodes.map((function(e){return{id:String(e.id),type:e.type,label:e.label,properties:{name:e.properties.name}}})),this.upload_links=this.info.links.map((function(e){return{type:e.type,id:String(e.id),label:e.label,source:String(e.source.index),target:String(e.target.index),properties:e.properties}})),console.log(this.info),console.log(this.current_user),console.log("nn",JSON.stringify(this.upload_nodes)),console.log("nn",JSON.stringify(this.upload_links));var e={user:this.current_user,nodes:this.upload_nodes,links:this.upload_links};window.navigator.sendBeacon("http://graphdb.ics.uci.edu:8080/postUserGraph",JSON.stringify(e))},beforeunloadHandler:function(e){if("home"===this.$route.name&&!0===this.viewGraph_btn_status)return e=e||window.event,e&&(console.log("hahaha",this.info),e.returnValue="关闭提示"),"关闭提示";console.log("lalala"),window.onbeforeunload=null},unloadHandler:function(e){if("home"===this.$route.name&&!0===this.viewGraph_btn_status&&!0===this.has_weight){this.upload_nodes=this.info.nodes.map((function(e){return{id:String(e.id),type:e.type,label:e.label,properties:{name:e.properties.name}}})),this.upload_links=this.info.links.map((function(e){return{type:e.type,id:String(e.id),label:e.label,source:String(e.source.index),target:String(e.target.index),properties:e.properties}})),console.log(this.info),console.log(this.current_user),console.log("nn",JSON.stringify(this.upload_nodes)),console.log("nn",JSON.stringify(this.upload_links));var t={user:this.current_user,nodes:this.upload_nodes,links:this.upload_links};navigator.sendBeacon("http://graphdb.ics.uci.edu:8080/postUserGraph",JSON.stringify(t))}},getGraphStatistics:function(){console.log("haha"),this.$router.push({name:"dashboard",params:{username:this.username}})},instruction:function(){this.dialogFormVisible_instruction=!0},TeamLogin:function(){this.$router.push({name:"login"})},readTxt:function(){console.log(k.split("\n"));var e=k.split("\n").map((function(e){return{value:e,label:e}}));console.log(e),this.link_list=e},search:function(e){var t=this;""!==this.input?(this.$refs[e].$el.click(),this.node_value=[],this.disableSelect=!1,this.$axios({url:"https://en.wikipedia.org/w/api.php?action=query&list=search&srsearch=intitle:+"+this.input+"+&srprop=snippet&format=json&origin=*&callback=",method:"get"}).then((function(e){var n=[];console.log(e.data),e.data=e.data.slice(5),e.data=e.data.slice(0,e.data.length-1);for(var i=JSON.parse(e.data).query.search,a=0;a<i.length;a++)-1===i[a].title.search("(disambiguation)")&&-1===i[a].title.search("List of")&&-1===i[a].title.search("list of")&&(i[a].snippet=i[a].snippet.replace(/<[^>]*>|/g,"").replace(/\(.*?\)/g,""),n.push(i[a]),t.snippet[i[a].title]=i[a].snippet);t.node_list=n.map((function(e){return{value:e.title,label:e.title,snippet:e.snippet}})),t.btnChangeEnable=!1,t.node_value=t.node_list[0].value,t.select_snippet=t.node_list[0].snippet}))):alert("Input can not be empty"),this.$forceUpdate()},blur:function(){console.log("lose")},focus:function(){console.log("get"),console.log(this.$refs),this.$refs["select"].focus()},searchConcept_dialog:function(){this.dialogFormVisible_viewCollective=!0},getAllConcepts:function(){var e=this,t=null;this.viewGraph_btn_status=!this.viewGraph_btn_status,!1===this.viewGraph_btn_status&&(this.temp_linklist=[],this.temp_nodelist=[],t=this.submitData()),!1===t?(this.viewGraph_btn_status=!0,console.log("o")):(this.disable_submit=!0,!1===this.viewGraph_btn_status?(this.readOnly=!0,this.$axios({url:"/getAllConcepts",method:"get"}).then((function(t){e.disable_searchConcept=!1,e.dialogFormVisible_viewCollective=!0,e.collective_node_list=t.data.nodes.map((function(e){return{value:e,label:e}}))})),this.renderGraph({nodes:[],links:[]})):(this.readOnly=!1,this.handleShow()))},collapseConcept:function(e){console.log("node collapsed",e);for(var t=0;t<this.info.nodes.length;t++)this.info.nodes[t].properties.name===e.properties.name&&(this.info.nodes[t].if_expanded=!1);for(var n=[],i=0;i<this.info.links.length;i++)this.info.links[i].source.properties.name!==e.properties.name&&this.info.links[i].target.properties.name!==e.properties.name||n.push(this.info.links[i]);for(var a=[],s=[],o=[],l=[],r=[],c=[],d=[],u=[],h=[],p=[],g=0;g<n.length;g++)n[g].source.properties.name===e.properties.name?(a.push(n[g].target),s.push(n[g].target.properties.name)):n[g].target.properties.name===e.properties.name&&(a.push(n[g].source),s.push(n[g].source.properties.name));for(var m=0;m<a.length;m++)a[m].weight>1&&(o.push(a[m]),l.push(a[m].properties.name));for(var f={},_=0;_<l.length;_++){var v=l[_];f[v]=f[v]?f[v]+1:1}for(var b=0;b<o.length;b++)o[b].weight-f[l[b]]===0&&-1===c.indexOf(l[b])&&(r.push(o[b]),c.push(o[b].properties.name));for(var k=0;k<a.length;k++)1===a[k].weight&&(d.push(a[k]),h.push(a[k].properties.name));for(var y=0;y<r.length;y++)d.push(r[y]),h.push(r[y].properties.name);for(var x=[],w=[],C=0;C<a.length;C++)-1===h.indexOf(s[C])&&(x.push(a[C]),w.push(s[C]));for(var N=0;N<n.length;N++)(h.indexOf(n[N].source.properties.name)>-1||h.indexOf(n[N].target.properties.name)>-1)&&(u.push(n[N]),p.push(n[N].id));console.log("所有与该node相连的links集合",n),console.log("所有与该node有关系的node集合",a),console.log("这个node集合的名字",s),console.log("2个node之间有多个link的情况",o,l,f),console.log("只有和目标node存在多个关系的node(不连接其他node)",r,c),console.log("所有不需要collapse的nodes集合",x,w),console.log("所有需要collapse的nodes集合",d,h),console.log("所有需要collapse的links集合",u,p);for(var S=this.info.nodes.length-1;S>0;S--)h.indexOf(this.info.nodes[S].properties.name)>-1&&this.info.nodes.splice(S,1);for(var O=this.info.links.length-1;O>0;O--)p.indexOf(this.info.links[O].id)>-1&&this.info.links.splice(O,1);for(var V=0;V<this.info.nodes.length;V++)this.info.nodes[V].id=V,this.info.nodes[V].index=V;for(var U=0;U<this.info.links.length;U++)this.info.links[U].id=U;console.log("Nodes 最后的结果",this.info.nodes),console.log("Links 最后的结果",this.info.links);var R=this.info.nodes.map((function(e){return{id:e.id,type:e.type,properties:{name:e.properties.name},label:e.label,snippet:e.snippet,if_expanded:e.if_expanded}})),$=this.info.links.map((function(e){return{source:e.source.id,target:e.target.id,id:e.id,type:e.type,properties:{},label:e.label}}));console.log("stringfy node",R),console.log("stringfy links",$);var G=[];G.nodes=R,G.links=$,this.renderGraph(G)},expandConcept:function(e){var t=this;console.log("node name",e),console.log("current info",this.info);var n=[],i=[];this.$axios({url:"/getAllNodeConnections",method:"post",data:{node:e}}).then((function(e){console.log(e.data),n=e.data.links.map((function(e){return e.source=Number(e.source),e.target=Number(e.target),e.id=Number(e.id),e})),i=e.data.nodes.map((function(e){return e.id=Number(e.id),e}));var a=t.mergeNodes(t.temp_nodelist,i);console.log("temp node",t.temp_nodelist);for(var s=a[0],o=a[1],l=0;l<n.length;l++)n[l].source=o[n[l].source],n[l].target=o[n[l].target];var r=t.mergeLinks(t.temp_linklist,n);t.temp_linklist=r,t.temp_nodelist=s,t.info.nodes=s,t.info.links=r;for(var c=0;c<t.info.nodes.length;c++)!0===t.info.nodes[c].if_expanded?console.log("expanded node",t.info.nodes[c]):t.info.nodes[c]["if_expanded"]=!1;t.renderGraph(t.info)}))},mergeLinks:function(e,t){e.length,t.length;e=e.map((function(e){return e.source=e.source.id,e.target=e.target.id,e}));var n=e.map((function(e){return[e.label,e.source,e.target].toString()}));console.log(n);for(var i=0;i<t.length;i++)n.indexOf([t[i].label,t[i].source,t[i].target].toString())>-1||(t[i].id=e.length,e.push(t[i]));return e},mergeNodes:function(e,t){e.length,t.length;for(var n=[],i="",a=e.map((function(e){return e.properties.name})),s=0;s<t.length;s++)i=t[s].id,a.indexOf(t[s].properties.name)>-1?n[i]=a.indexOf(t[s].properties.name):(t[s].id=e.length,e.push(t[s]),n[i]=t[s].id);return[e,n]},searchConcept:function(){var e=this,t=[],n=[];console.log("concept value",this.collective_node_value),this.$axios({url:"/getAllNodeConnections",method:"post",data:{node:this.collective_node_value}}).then((function(i){console.log(i),t=i.data.links.map((function(e){return e.source=Number(e.source),e.target=Number(e.target),e.id=Number(e.id),e})),n=i.data.nodes.map((function(e){return e.id=Number(e.id),e})),e.temp_nodelist=n,e.temp_linklist=t,console.log("temp node",e.temp_nodelist),console.log("temp list",e.temp_linklist),e.dialogFormVisible_viewCollective=!1,e.info.nodes=e.temp_nodelist,e.info.links=e.temp_linklist;var a=e.collective_node_value;e.info.nodes=e.info.nodes.map((function(e){return e.properties.name===a?e.if_expanded=!0:e["if_expanded"]=!1,e})),e.collective_node_value="",e.renderGraph(e.info)}))},createUser:function(){var e=this;this.dialog_createUser=!1,console.log("create user function",this.newUsername),this.$axios({url:"/createNewUser",method:"post",data:{user:this.newUsername}}).then((function(t){e.username=e.newUsername,e.newUsername="",console.log(t),204===t.status?(e.$message({type:"warning",message:"The username already exists!"}),e.showLogin=!0,e.dialog_createUser=!0,e.username=""):e.$axios({url:"/getUserGraph",method:"post",data:{user:e.username}}).then((function(t){e.showLogin=!1;var n=t.data.nodes,i=t.data.links,a=n.map((function(e){return e.id=Number(e.id),e})),s=i.map((function(e){return e.id=Number(e.id),e.source=Number(e.source),e.target=Number(e.target),e}));e.info.nodes=a,e.info.links=s,e.current_user=t.data.user,e.renderGraph(e.info)}))}))},handleShow:function(){var e=this;console.log("cccc"),console.log("handleshow username",this.username),console.log(this.$route.params),this.$axios({url:"/getUserGraph",method:"post",data:{user:this.username}}).then((function(t){if(204===t.status)alert("Wrong username or password !"),e.centerDialogVisible=!0;else{"wmt4"!==e.username&&"sqy"!==e.username||(e.dashboard_show=!0),e.centerDialogVisible=!1,e.disable_dbclick=!1,console.log(t),e.showLogin=!1;var n=t.data.nodes,i=t.data.links,a=n.map((function(e){return e.id=Number(e.id),e})),s=i.map((function(e){return e.id=Number(e.id),e.source=Number(e.source),e.target=Number(e.target),e}));e.info.nodes=a,e.info.links=s,e.current_user=t.data.user,e.$message({type:"success",message:"Welcome Back, "+e.current_user}),e.renderGraph(e.info)}})).catch((function(t){e.showLogin=!0,e.username=""}))},onTapLogin:function(){this.centerDialogVisible=!0},logout:function(){this.showLogin=!0,this.disable_dbclick=!0,this.disable_initGraph=!0,this.disable_submit=!0,this.disable_viewGraph=!0,this.disable_searchConcept=!0,this.viewGraph_btn_status=!0,this.dashboard_show=!1,this.username="",this.info={nodes:[],links:[]},this.renderGraph(this.info)},showOption_view_graph:function(){var e=this.$refs.viewCollective.$children[0].value;this.optionVisible_viewGraph=e.length>=2,this.$forceUpdate()},selectFocus:function(){console.log("lalala")},showOption_add_link:function(){this.$refs.addLink.$children[0].value;this.optionVisible_add_link=!0,this.$forceUpdate()},showOption_change_link:function(){this.$refs.changeLinkName.$children[0].value;this.optionVisible_change_link=!0,this.$forceUpdate()},selectClear:function(){this.node_value="",this.link_value="",this.new_node_name="",this.new_link_name="",this.init_node_value="",this.collective_node_value="",this.optionVisible_add_link=!1,this.optionVisible_change_link=!1,this.optionVisible_viewGraph=!1,this.disableSelect=!0,this.input="",this.node_list=[],this.$forceUpdate()},selectChange:function(e){console.log(e),""!==e&&(this.btnChangeEnable=!1),!0===this.dialogFormVisible_link?this.link_value=e:!0===this.dialogFormVisible_change_link_name?this.new_link_name=e:!0===this.dialogFormVisible_change_node_name?(this.new_node_name=e,this.select_snippet=this.snippet[this.node_value],console.log("snippet",this.select_snippet)):!0===this.dialogFormVisible?(this.node_value=e,this.select_snippet=this.snippet[this.node_value],console.log("snippet",this.select_snippet)):!0===this.dialogFormVisible_initGraph?this.init_node_value=e:!0===this.dialogFormVisible_viewCollective&&(this.collective_node_value=e),this.$forceUpdate()},cancel:function(){this.dialogFormVisible=!1,this.dialogFormVisible_link=!1,this.dialogFormVisible_change_node_name=!1,this.dialogFormVisible_change_link_name=!1,this.temp.length=0,this.newUsername="",this.btnChangeEnable=!0,this.dialogFormVisible_initGraph=!1,this.selectClear()},collectiveGraph_cancel:function(){this.renderGraph(this.info),this.dialogFormVisible_viewCollective=!1,this.viewGraph_btn_status=!0,this.readOnly=!1},showInitGraph:function(){this.dialogFormVisible_initGraph=!0},InitGraph:function(){console.log(this.info),console.log(document.getElementById("init")),this.btnChangeEnable=!0,console.log("add a start node");var e={id:0,type:"node",label:"Device",properties:{name:this.init_node_value}};this.dialogFormVisible_initGraph=!1,this.info.nodes.push(e),this.renderGraph(this.info),this.selectClear()},addNodes:function(){var e=this.doubleClick(this.info,this.info.nodes,this.node_value,this.select_snippet);this.btnChangeEnable=!0,console.log("flag",e),!0===e?(this.dialogFormVisible=!1,this.selectClear()):(this.dialogFormVisible=!0,this.selectClear())},change_node_name:function(){this.info.nodes[this.node_id].properties.name=this.new_node_name,this.info.nodes[this.node_id].snippet=this.select_snippet,this.dialogFormVisible_change_node_name=!1,this.btnChangeEnable=!0,this.renderGraph(this.info),this.selectClear()},change_link_name:function(){this.info.links[this.link_id].label=this.new_link_name,this.dialogFormVisible_change_link_name=!1,this.btnChangeEnable=!0,this.renderGraph(this.info),this.selectClear()},addLinks:function(){console.log("add link",this.optionVisible,this.optionVisible_link),this.dialogFormVisible_link=!1,2===this.temp.length&&this.singleClick(this.info,this.selected_Node,this.link_value),this.$message({type:"success",message:"Add Links!"}),this.btnChangeEnable=!0,this.selectClear()},drag_addLinks:function(){this.dialogFormVisible_link=!1,console.log("add drag links",this.start.index,this.end.index);var e={source:this.start.index,target:this.end.index,id:this.info.links.length,type:"link",properties:{},label:this.link_value},t=[];console.log("temp node",this.temp[0]);for(var n=0;n<this.info.links.length;n++)this.info.links[n].source.properties.name===this.start.properties.name&&this.info.links[n].target.properties.name===this.end.properties.name&&t.push(this.info.links[n].label);console.log("link name set",t),t.indexOf(e.label)>-1?(console.log("This label is already used "),this.$message({type:"warning",message:"There is already a relationship with that name!"})):(this.info.links.push(e),console.log("new link added",this.info,Object(v["a"])(this.info))),this.renderGraph(this.info),this.ifClicked=!1,this.selectClear()},renderGraph:function(e){var t=this;!1===this.viewGraph_btn_status&&!1===this.showLogin&&(this.disable_submit=!0,this.disable_searchConcept=!1),console.log("render data",e),!1===this.showLogin&&!0===this.viewGraph_btn_status&&(this.disable_submit=!1,this.disable_viewGraph=!1,this.disable_searchConcept=!0);var n=e.links,i=e.nodes;w(n),console.log("render graph link",n);var a="";i.map((function(e){return a=a.concat(e.properties.name,"%7C"),a})),i!==[]&&this.$axios({url:"https://en.wikipedia.org/w/api.php?action=query&prop=extracts&titles="+a+"&redirects=&exintro=true&exsentences=1&format=json&origin=*&callback=",method:"get"}).then((function(e){e.data=e.data.slice(5),e.data=e.data.slice(0,e.data.length-1);var t=JSON.parse(e.data).query.pages;console.log("wiki",t);for(var n=[],a=0;a<Object.keys(t).length;a++){var s=String(t[Object.keys(t)[a]].extract).replace(/<[^>]*>|/g,"").replace(/\(.*?\)/g,"");s=s.replaceAll("\n","");var o=String(t[Object.keys(t)[a]].title);n[o]=s}for(var l=0;l<Object.keys(n).length;l++)localStorage.hasOwnProperty(Object.keys(n)[l])||localStorage.setItem(Object.keys(n)[l],n[Object.keys(n)[l]]);for(var r=0;r<i.length;r++)i[r].snippet=localStorage.getItem(i[r].properties.name)})),b["select"]("#graph").html("");var s=b["layout"].force().nodes(i).links(n).linkDistance(500).charge(-1500).on("tick",(function(){S()})).start();if(this.info!==[]){for(var o=[],l=0;l<this.info.nodes.length;l++)0===this.info.nodes[l].weight&&o.push(this.info.nodes[l].properties.name);console.log("noweight node",o),console.log(0===o.length),console.log(this.has_weight),this.has_weight=0===o.length}var r=b["behavior"].zoom().scaleExtent([.4,2]).on("zoom",_),c=b["select"]("#graph").append("svg").attr("pointer-event","all").attr("preserveAspectRatio","xMidYMid meet").attr("viewBox","-500 -200 2000 2000").call(r).on("touchmove",null).on("dblclick",(function(e,n){console.log("svg node",e,n,b["select"](b["event"].target).datum()),b["event"].defaultPrevented||(clearTimeout(t.clickTimeId),!0===t.readOnly||!0===t.disable_dbclick?console.log("read mode only"):void 0===b["select"](b["event"].target).datum()&&(t.dialogFormVisible=!0))})),d=c.selectAll("circle").data(s.nodes()).enter().append("g").attr("class",(function(e,t){return"g_circle_"+t})).style("cursor","pointer").call(x(this)).on("click",(function(e,n){b["event"].defaultPrevented||(t.dragNode=e,console.log("dragNode",e),clearTimeout(t.clickTimeId),t.clickTimeId=setTimeout((function(){!0===t.readOnly?console.log("read only mode"):u(e,n,t)}),250))})).on("mouseover",(function(e){b["event"].defaultPrevented||(t.showdetail_node=!0,t.detailValue=e,t.detailname=e.properties.name,b["select"](".g_circle_"+e.index).select("circle").attr("r",50),b["select"](".g_circle_"+e.index).select("tspan").attr("font-size",25))})).on("mouseout",(function(e){b["select"](".g_circle_"+e.index).select("circle").attr("r",40),b["select"](".g_circle_"+e.index).select("tspan").attr("font-size",15)})).on("dblclick",(function(e){b["event"].defaultPrevented||(clearTimeout(t.clickTimeId),!0===t.readOnly?!0===e.if_expanded?(e.if_expanded=!1,t.collapseConcept(e)):(e.if_expanded=!0,t.expandConcept(e.properties.name)):t.dialogFormVisible=!0)})).on("contextmenu",(function(e,n){b["event"].defaultPrevented||(!0===t.readOnly?console.log("read only mode"):U(t.menu)(e,b["event"],n))}));function u(e,t,n){console.log(n.ifClicked),d.attr("node",(function(t){t.index===e.index&&!1===n.ifClicked?(b["select"](".g_circle_"+t.index).select("circle").style("fill","red"),console.log("haha",b["select"](".g_circle_"+t.index).select("circle")),n.ifClicked=!0,console.log("新选的 true",n.ifClicked)):t.index===e.index&&!0===n.ifClicked?(b["select"](".g_circle_"+t.index).select("circle").style("fill",(function(e){return C(e)})),n.ifClicked=!1,console.log("重复选的颜色变回去 false",n.ifClicked)):t.index!==e.index&&(console.log("node are different"),b["select"](".g_circle_"+t.index).select("circle").style("fill",(function(e){return C(e)})))}))}c.on("dblclick.zoom",null),d.on("dblclick.zoom",null);var h=d.append("circle").style("stroke-width","2px").attr("r",40).style("fill",(function(e){return C(e)}));console.log("circle",h);var p=d.append("text").attr("dy",".35em").attr("text-anchor","middle").style("fill","black").attr("x",(function(e){N(e,this)}));h.append("svg:title").text((function(e){switch(e.type){case"node":return e.properties.name}})),p.append("svg:title").text((function(e){switch(e.type){case"node":return e.properties.name}}));var g=c.append("defs");g.append("marker").attr("id","end").attr("markerUnits","strokeWidth").attr("markerUnits","userSpaceOnUse").attr("markerWidth",20).attr("markerHeight",20).attr("viewBox","0 -4 12 15").attr("refX",0).attr("refY",0).attr("orient","auto").append("svg:path").attr("stroke-width",7).attr("d","M0,-5L10,0L0,5").attr("fill","rgba(0,0,0, 0.7)"),g.append("marker").attr("id","start").attr("markerUnits","strokeWidth").attr("markerUnits","userSpaceOnUse").attr("markerWidth",20).attr("markerHeight",20).attr("viewBox","0 -4 12 15").attr("refX",0).attr("refY",0).attr("orient","auto").append("svg:path").attr("stroke-width",7).attr("d","M0,0L10,-5L10,5").attr("fill","rgba(0,0,0, 0.7)");var m=c.append("g").selectAll(".edgepath").data(s.links()).enter().append("path").style("stroke","black").style("stroke-width",2).style("fill-opacity",0).style("cursor","pointer").attr("id",(function(e,t){return"edgepath"+t})).on("mouseover",(function(e,t){return v(e,t)})).on("mouseout",(function(){m.style("stroke-width",3),f.selectAll("textPath").attr("font-size",20)})).on("contextmenu",(function(e,n){b["event"].defaultPrevented||(!0===t.readOnly?console.log("read only mode"):U(t.menu_edge)(e,b["event"],n))})),f=c.append("g").selectAll(".edgetext").data(n).enter().append("text").attr("class","linetext").attr("text-anchor","middle").attr("fill-opacity",.8).style("cursor","pointer").attr({class:"edgelabel",id:function(e,t){return"edgepath"+t},dx:250,dy:-1,fill:"black"});function _(){c.attr("transform","scale("+b["event"].scale+")")}function v(e,t){b["select"]("path#edgepath"+t).style("stroke-width",(function(e){return 6})),b["select"]("text#edgepath"+t).select("textPath").attr("font-size",25)}function k(e){var t=e.source.x,n=e.source.y,i=e.target.x,a=e.target.y,s=Math.sqrt(Math.pow(i-t,2)+Math.pow(a-n,2));return s/2}function x(e){var t=c.append("path").attr("id","mouse_link").style("stroke","black").style("stroke-width",2).style("fill-opacity",0).attr("marker-end","url(#end)");return s.drag().on("dragstart",(function(t){!0===e.ifClicked&&(e.dragStartIndex=t,e.mouseLinkLineStartLoc=[t.x,t.y],s.stop(),e.original_dx=t.px,e.original_dy=t.py,console.log("start position",e.original_dx,e.original_dy)),b["event"].sourceEvent.stopPropagation(),t.fixed=!0})).on("drag",(function(n){f.attr("dx",(function(e){return k(e)})).attr("dy",(function(e){return-5})),!0===e.ifClicked&&e.dragNode===n&&(s.stop(),t.style("opacity","1"),t.attr("d",(function(){return void 0===b["select"](b["event"].sourceEvent.srcElement).datum()?(b["select"](".g_circle_"+e.target_node_index).select("circle").style("fill",(function(e){return C(e)})),"M"+n.x+" "+n.y+"L"+ +b["mouse"](b["event"].sourceEvent.srcElement)[0]+" "+b["mouse"](b["event"].sourceEvent.srcElement)[1]):(b["select"](".g_circle_"+b["select"](b["event"].sourceEvent.srcElement).datum().index).select("circle").style("fill","red"),"M"+e.mouseLinkLineStartLoc[0]+" "+e.mouseLinkLineStartLoc[1]+"L"+ +b["select"](b["event"].sourceEvent.srcElement).datum().x+" "+b["select"](b["event"].sourceEvent.srcElement).datum().y)})),void 0!==b["select"](b["event"].sourceEvent.srcElement).datum()&&n.index!==b["select"](b["event"].sourceEvent.srcElement).datum().index&&(e.target_node_index=b["select"](b["event"].sourceEvent.srcElement).datum().index))})).on("dragend",(function(n){if(!0===e.ifClicked){n.px=e.original_dx,n.py=e.original_dy;var i=b["select"](b["event"].sourceEvent.srcElement).datum();e.end=i,e.start=n,void 0!==i&&"link"!==e.end.type?e.start.index===e.end.index?t.style("opacity","0"):(e.dialogFormVisible_link=!0,t.style("opacity","0"),b["select"](".g_circle_"+n.index).select("circle").style("fill",(function(e){return C(e)})),e.ifClicked=!1):(b["select"](".g_circle_"+n.index).select("circle").style("fill",(function(e){return C(e)})),e.ifClicked=!1,t.style("opacity","0")),s.resume()}}))}function C(e){return"#FF9D00"}function N(e,t){var n="";"node"===e.type&&e.properties.name?n=e.properties.name:"Position"===e.label?n=e.positionCode:"Application"===e.label?n=e.applicationName:"Manufacturer"===e.label?n=e.manufacturerName:"IotInfrastructure"===e.label?n=e.iotInfrastructureName:"DeviceAdmin"===e.label&&(n=e.name),b["select"](t).append("tspan").attr("x",0).attr("y",0).attr("font-size",15).text((function(){return n}))}function S(){h.attr("transform",O),p.attr("transform",V),m.attr("d",(function(e){return y(e)})),m.attr("marker-end",(function(e,t){return e.x_start<e.x_end?"url(#end)":""})).attr("marker-start",(function(e,t){return e.x_start>=e.x_end?"url(#start)":""}))}function O(e){return isNaN(e.x)&&isNaN(e.y)&&(e.x=360,e.y=266),e.x<=-430?e.x=-430:e.x>=1150&&(e.x=1150),e.y<=-168?e.y=-168:e.y>=700&&(e.y=700),"translate("+e.x+","+e.y+")"}function V(e){return isNaN(e.x)&&isNaN(e.y)&&(e.x=360,e.y=266),e.x<=-430?e.x=-430:e.x>=1150&&(e.x=1150),e.y<=-168?e.y=-168:e.y>=700&&(e.y=700),"translate("+e.x+","+e.y+")"}function U(e,t){return b["event"].preventDefault(),b["selectAll"](".d3-context-menu").data([1]).enter().append("div").attr("class","d3-context-menu"),b["select"]("body").on("click.d3-context-menu",(function(){b["select"](".d3-context-menu").style("display","none")})),function(n,i,a){b["selectAll"](".d3-context-menu").html("");var s=b["selectAll"](".d3-context-menu").append("ul");s.selectAll("li").data(e).enter().append("li").html((function(e){return e.title})).on("click",(function(e){e.action(a,n),b["select"](".d3-context-menu").style("display","none")})),t&&t(a),b["select"](".d3-context-menu").style("left",i.pageX-2+"px").style("top",i.pageY-2+"px").style("display","block"),b["event"].preventDefault()}}f.append("textPath").attr("xlink:href",(function(e,t){return"#edgepath"+t})).attr("font-size",20).text((function(e){return e.label})).on("mouseover",(function(e,t){v(e,t)})).on("mouseout",(function(e,t){b["select"]("text#edgepath"+t).select("textPath").attr("font-size",20),m.style("stroke-width",3)})).on("contextmenu",(function(e,n){console.log("huahua",e,n),b["event"].defaultPrevented||(!0===t.readOnly?console.log("read only mode"):U(t.menu_edge)(e,b["event"],n))})),console.log("edge line",m)},doubleClick:function(e,t,n,i){for(var a=!1,s=0;s<this.info.nodes.length;s++)this.info.nodes[s].properties.name===n&&(a=!0);if(!1===a){var o={id:t.length,type:"node",properties:{name:n},label:"Concept",snippet:i,if_expanded:!1};return e.nodes.push(o),this.renderGraph(e),!0}return this.$message({type:"warning",message:"There is already a concept with that name!"}),!1},singleClick:function(e,t,n){if(2===this.temp.length&&this.temp[0]!==this.temp[1]){var i={source:this.temp[0],target:this.temp[1],id:this.info.links.length,type:"link",properties:{},label:n};e.links.push(i),console.log("new link added",e),this.temp.length=0,this.renderGraph(e)}else 2===this.temp.length&&this.temp[0]===this.temp[1]&&(this.temp.length=0);0===this.temp.length&&this.renderGraph(e),console.log("current select node id",this.temp)},submitData:function(){var e=this;console.log("submit data",this.info),this.upload_nodes=this.info.nodes.map((function(e){return{id:String(e.id),type:e.type,label:e.label,properties:{name:e.properties.name}}})),this.upload_links=this.info.links.map((function(e){return{type:e.type,id:String(e.id),label:e.label,source:String(e.source.index),target:String(e.target.index),properties:e.properties}})),console.log(this.current_user);var t=[];console.log("testtest",this.info);for(var n=0;n<this.info.nodes.length;n++)0===this.info.nodes[n].weight&&(!1,t.push(this.info.nodes[n].properties.name));if(!1===this.has_weight)return this.$message({type:"warning",message:"The node [ "+t.toString()+" ] needs a least one link, please check it."}),!1;this.$axios({headers:{"Content-Type":"application/json;"},url:"/postUserGraph",method:"post",data:{user:this.current_user,nodes:this.upload_nodes,links:this.upload_links}}).then((function(t){return console.log("pp",JSON.stringify(e.upload_nodes)),console.log("pp",JSON.stringify(e.upload_links)),console.log("success",t),e.$message({type:"success",message:"Submitted Successfully!"}),!0})).catch((function(t){return console.log("error",t),e.$message({type:"warning",message:"The database server is breakdown, please contact the maintainer!"}),!1}))},reload:function(){this.renderGraph(this.info)}}},N=C,S=(n("7df3"),Object(r["a"])(N,f,_,!1,null,null,null)),O=S.exports,V=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"title",rawName:"v-title"}],attrs:{"data-title":"Login"}},[n("el-dialog",{attrs:{"close-on-click-modal":!1,title:"Login",visible:e.centerDialogVisible,width:"30%",center:""},on:{"update:visible":function(t){e.centerDialogVisible=t}}},[n("span",[e._v("Username"),n("el-input",{attrs:{placeholder:"Please Input Username"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.login(t)}},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}})],1),n("br"),n("br"),n("el-button",{staticStyle:{"margin-top":"15px"},attrs:{type:"text"},nativeOn:{click:function(t){e.dialog_createUser=!0,e.centerDialogVisible=!1}}},[e._v("No account?")]),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.login(t)}}},[e._v("Yes")])],1)],1),n("el-dialog",{attrs:{"close-on-click-modal":!1,title:"Create New Account",visible:e.dialog_createUser,width:"30%",center:""},on:{"update:visible":function(t){e.dialog_createUser=t}}},[n("span",[e._v("Username"),n("el-input",{attrs:{placeholder:"Please Input Username"},model:{value:e.newUsername,callback:function(t){e.newUsername=t},expression:"newUsername"}})],1),n("br"),n("br"),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{nativeOn:{click:function(t){e.dialog_createUser=!1,e.centerDialogVisible=!0}}},[e._v("No")]),n("el-button",{attrs:{type:"primary"},on:{click:e.createUser}},[e._v("Yes")])],1)])],1)},U=[],R={name:"App",data:function(){return{centerDialogVisible:!0,dialog_createUser:!1,username:"",newUsername:""}},methods:{login:function(){var e=this;""===this.username?this.$message({type:"warning",message:"The username cannot be empty"}):this.$axios({url:"/getUserGraph",method:"post",data:{user:this.username}}).then((function(t){204===t.status?(e.$message({type:"warning",message:"Wrong username !"}),e.centerDialogVisible=!0):e.$router.push({name:"home",params:{username:e.username}})}))},createUser:function(){var e=this;this.dialog_createUser=!1,console.log("create user function",this.newUsername),""===this.newUsername?(this.$message({type:"warning",message:"The username cannot be empty"}),this.dialog_createUser=!0):this.$axios({url:"/createNewUser",method:"post",data:{user:this.newUsername}}).then((function(t){e.username=e.newUsername,e.newUsername="",console.log(t),204===t.status?(e.$message({type:"warning",message:"The username already exists!"}),e.showLogin=!0,e.dialog_createUser=!0,e.username=""):e.$axios({url:"/getUserGraph",method:"post",data:{user:e.username}}).then((function(t){e.$router.push({name:"home",params:{username:e.username}})}))}))}}},$=R,G=Object(r["a"])($,V,U,!1,null,null,null),L=G.exports,E=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"title",rawName:"v-title"}],staticClass:"block",attrs:{"data-title":"Dashboard"}},[n("el-header",{staticStyle:{"text-align":"right",height:"40px"}},[n("div",{staticClass:"grid-content "},[n("h3",{staticStyle:{"margin-right":"750px"}},[e._v("SustainKG")])])]),n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:"","default-sort":{prop:"date",order:"descending"}}},[n("el-table-column",{attrs:{prop:"Id",label:"Id",width:"100"}}),n("el-table-column",{attrs:{prop:"User",label:"User",sortable:"",width:"700"}}),n("el-table-column",{attrs:{prop:"Nodes",label:"Nodes",sortable:"",width:"180"}}),n("el-table-column",{attrs:{prop:"Links",sortable:"",label:"Links"}})],1),e._m(0),n("el-pagination",{staticClass:"fy",attrs:{layout:"total",total:e.total},on:{"current-change":e.handleCurrentChange}})],1)},F=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("h2")])}],M={mounted:function(){"sqy"===this.username||"wmt4"===this.username?this.getData():console.log("no authority")},data:function(){return{username:this.$route.params.username,password:this.$route.params.password,total:0,pagesize:10,currentPage:1,tableData:[]}},methods:{handleCurrentChange:function(e){this.currentPage=e},getData:function(){var e=this;this.$axios({url:"/getGraphStatistics",method:"get"}).then((function(t){e.tableData=t.data.map((function(e,t){return{Id:t,User:e.name,Nodes:e.nodes,Links:e.links}})),e.total=e.tableData.length,console.log(t.data)}))}}},T=M,D=(n("2fe3"),Object(r["a"])(T,E,F,!1,null,null,null)),P=D.exports;i["default"].use(u["a"]),i["default"].prototype.axios=p.a;var q=[{path:"/",name:"home",component:O},{path:"/login",name:"login",component:L},{path:"/dashboard",name:"dashboard",component:P}],I=q,j=n("b2d6"),A=n.n(j);i["default"].config.productionTip=!1,i["default"].use(u["a"]),i["default"].use(m.a,{locale:A.a}),p.a.defaults.headers.post["Content-Type"]="application/json",i["default"].prototype.$axios=p.a,p.a.defaults.baseURL="/api";var z=new u["a"]({mode:"history",routes:I,base:"/dist/"});i["default"].directive("title",{inserted:function(e,t){document.title=e.dataset.title}}),new i["default"]({router:z,render:function(e){return e(d)}}).$mount("#app")},"5c4c":function(e,t,n){},"7df3":function(e,t,n){"use strict";var i=n("5c4c"),a=n.n(i);a.a}});
//# sourceMappingURL=app.ab676480.js.map